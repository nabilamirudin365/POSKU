<Window x:Class="POSKU.Desktop.PurchaseWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:POSKU.Desktop"
        Title="Pembelian (Stock-In)"
                Height="560"
                Width="900"
                WindowStartupLocation="CenterOwner">

        <Window.Resources>
                <local:PurchaseLineSubtotalConverter x:Key="PurchaseLineSubtotalConverter"/>
        </Window.Resources>

        <!-- PENTING: biarkan LastChildFill default (true),
       lalu pastikan DataGrid menjadi anak TERAKHIR -->
        <DockPanel Margin="12">

                <!-- TOP BAR -->
                <StackPanel DockPanel.Dock="Top"
                                Orientation="Horizontal"
                                Margin="0,0,0,10">
                        <TextBox Width="200"
                                        Margin="0,0,8,0"
                                 Text="{Binding Supplier, UpdateSourceTrigger=PropertyChanged}"
                                 ToolTip="Nama supplier (opsional)"/>
                        <TextBox Width="200"
                                        Margin="0,0,8,0"
                                        x:Name="EntryBox"
                                 Text="{Binding Entry, UpdateSourceTrigger=PropertyChanged}"
                                 ToolTip="Ketik SKU lalu Enter"
                                 KeyDown="EntryBox_KeyDown"/>
                        <Button Content="Tambah (Enter)"
                                        Padding="12,6"
                                        Command="{Binding AddByEntryCommand}"/>
                        <Button Content="Clear"
                                        Margin="8,0,0,0"
                                        Padding="12,6"
                                        Command="{Binding ClearCartCommand}"/>
                </StackPanel>

                <!-- FOOTER (letakkan SEBELUM DataGrid agar DataGrid jadi anak terakhir/fill) -->
                <StackPanel DockPanel.Dock="Bottom"
                                Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Margin="0,10,0,0">
                        <TextBlock Text="Subtotal: "
                                        FontSize="16"
                                        Margin="0,0,6,0"/>
                        <TextBlock Text="{Binding Subtotal, StringFormat=N0}"
                                        FontSize="16"
                                        FontWeight="Bold"/>
                        <TextBlock Text="    Grand Total: "
                                        FontSize="16"
                                        Margin="18,0,6,0"/>
                        <TextBlock Text="{Binding GrandTotal, StringFormat=N0}"
                                        FontSize="16"
                                        FontWeight="Bold"/>
                        <Button Content="Posting"
                                        Margin="18,0,0,0"
                                        Padding="18,8"
                                        Command="{Binding PostPurchaseCommand}"/>
                        <!-- CancelCommand belum ada, pakai ClearCartCommand saja -->
                        <Button Content="Batal"
                                        Width="100"
                                        Height="30"
                                        Margin="5,0,0,0"
                                Command="{Binding ClearCartCommand}"/>
                </StackPanel>

                <!-- GRID: jadikan anak TERAKHIR agar mengisi ruang -->
                <DataGrid ItemsSource="{Binding Cart}"
                                AutoGenerateColumns="False"
                                CanUserAddRows="False"
                                IsReadOnly="True">
                        <DataGrid.Columns>
                                <DataGridTextColumn Header="SKU"
                                                Binding="{Binding Sku}"
                                                Width="*"/>
                                <DataGridTextColumn Header="Nama"
                                                Binding="{Binding Name}"
                                                Width="2*"/>

                                <DataGridTemplateColumn Header="Cost"
                                                Width="*">
                                        <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                        <TextBox Text="{Binding Cost, UpdateSourceTrigger=PropertyChanged}"
                                                                 Width="100"
                                                                        HorizontalContentAlignment="Right"/>
                                                </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTemplateColumn Header="Qty"
                                                Width="*">
                                        <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                        <TextBox Text="{Binding Qty, UpdateSourceTrigger=PropertyChanged}"
                                                                 Width="80"
                                                                        HorizontalContentAlignment="Right"/>
                                                </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTextColumn Header="Subtotal"
                                                    Binding="{Binding SubtotalLine, StringFormat=N0}"
                                                    Width="*">
                                        <DataGridTextColumn.ElementStyle>
                                                <Style TargetType="TextBlock">
                                                        <Setter Property="TextAlignment"
                                                                        Value="Right"/>
                                                </Style>
                                        </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>


                                <DataGridTemplateColumn Header="Aksi"
                                                Width="160">
                                        <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                        <StackPanel Orientation="Horizontal"
                                                                        HorizontalAlignment="Center">
                                                                <Button Content="+"
                                                                                Width="30"
                                                                                Margin="2"
                                                                        Command="{Binding DataContext.IncQtyCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                        CommandParameter="{Binding}"/>
                                                                <Button Content="âˆ’"
                                                                                Width="30"
                                                                                Margin="2"
                                                                        Command="{Binding DataContext.DecQtyCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                        CommandParameter="{Binding}"/>
                                                                <Button Content="Hapus"
                                                                                Margin="2"
                                                                        Command="{Binding DataContext.RemoveLineCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                                        CommandParameter="{Binding}"/>
                                                        </StackPanel>
                                                </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                        </DataGrid.Columns>
                </DataGrid>

        </DockPanel>
</Window>
